<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Worked Example Using the IST Dataset â€¢ RESIDE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Worked Example Using the IST Dataset">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RESIDE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/RESIDE.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/exporting_marginal_distributions.html">Exporting Marginal Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/importing_marginal_distributions.html">Importing Marginal Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/synthesising_data.html">Synthesising Data from Marginal Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/worked_example.html">Worked Example Using the IST Dataset</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Worked Example Using the IST Dataset</h1>
            
      

      <div class="d-none name"><code>worked_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This R Markdown document illustrates example usage of the RESIDE
package using the IST dataset.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Load the RESIDE package and set a seed for reproducibility and store
the folder directory for export / import.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the Library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hehta.github.io/RESIDE/">RESIDE</a></span><span class="op">)</span></span>
<span><span class="co"># Set the seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># Store the folder path used for import / export</span></span>
<span><span class="va">folder_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summarise-original-data">Summarise original data<a class="anchor" aria-label="anchor" href="#summarise-original-data"></a>
</h2>
<p>Select the variables of interest and summarise. Selection of
variables is optional, if the variables are known. They may not be known
until the marginal distributions have been received.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select variables of interest from the IST dataset.</span></span>
<span><span class="va">IST_original</span> <span class="op">&lt;-</span> <span class="va">IST</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>  <span class="va">AGE</span>, <span class="co"># AGE at Randomisation</span></span>
<span>  <span class="va">SEX</span>, <span class="co"># SEX M/F</span></span>
<span>  <span class="va">RATRIAL</span>, <span class="co"># Atrial Fibrillation Y/N at Randomisation </span></span>
<span>  <span class="co"># (not coded for 984 patients in the pilot phase)</span></span>
<span>  <span class="va">RSBP</span>, <span class="co"># Systolic Blood Pressure at Randomisation</span></span>
<span>  <span class="va">STRK14</span> <span class="co"># Indicator of Any Stroke at 14 days</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the character variables to factors (to allow for summary)</span></span>
<span><span class="va">IST_original</span> <span class="op">&lt;-</span> <span class="va">IST_original</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="va">factor</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Produce a summary of the variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">IST_original</span><span class="op">)</span></span>
<span><span class="co">#&gt;       AGE        SEX       RATRIAL        RSBP           STRK14       </span></span>
<span><span class="co">#&gt;  Min.   :16.00   F: 9028    :  984   Min.   : 70.0   Min.   :0.00000  </span></span>
<span><span class="co">#&gt;  1st Qu.:65.00   M:10407   N:15282   1st Qu.:140.0   1st Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Median :73.00             Y: 3169   Median :160.0   Median :0.00000  </span></span>
<span><span class="co">#&gt;  Mean   :71.72                       Mean   :160.2   Mean   :0.04152  </span></span>
<span><span class="co">#&gt;  3rd Qu.:80.00                       3rd Qu.:180.0   3rd Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Max.   :99.00                       Max.   :295.0   Max.   :1.00000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-cox-model-on-the-original-data">Fit a cox model on the original data<a class="anchor" aria-label="anchor" href="#fit-a-cox-model-on-the-original-data"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load survival and dplyr libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span> <span class="co"># For Cox PH model</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># For data manipulation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co"># Stroke event is measured at 14 days, so set this for patients</span></span>
<span><span class="va">IST_original</span><span class="op">$</span><span class="va">DAY</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span></span>
<span><span class="co"># Illustrate the 984 missing values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IST_original</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 984</span></span>
<span></span>
<span><span class="co"># Remove the missing values</span></span>
<span><span class="va">IST_original</span> <span class="op">&lt;-</span> <span class="va">IST_original</span><span class="op">[</span><span class="op">!</span><span class="va">IST_original</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">==</span> <span class="st">""</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Drop the factor name for the missing values</span></span>
<span><span class="va">IST_original</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">IST_original</span><span class="op">$</span><span class="va">RATRIAL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarise the variable to show there are no longer missing values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">IST_original</span><span class="op">$</span><span class="va">RATRIAL</span><span class="op">)</span></span>
<span><span class="co">#&gt;     N     Y </span></span>
<span><span class="co">#&gt; 15282  3169</span></span>
<span></span>
<span><span class="co"># Fit a Cox PH model</span></span>
<span><span class="va">cox.ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">DAY</span>, <span class="va">STRK14</span><span class="op">)</span> <span class="op">~</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RATRIAL</span> <span class="op">+</span> <span class="va">RSBP</span>, data <span class="op">=</span> <span class="va">IST_original</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Output the summary of the Cox PH Model</span></span>
<span><span class="va">cox.ph</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(DAY, STRK14) ~ AGE + SEX + RATRIAL + RSBP, </span></span>
<span><span class="co">#&gt;     data = IST_original)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              coef exp(coef) se(coef)     z      p</span></span>
<span><span class="co">#&gt; AGE      0.005237  1.005251 0.003387 1.546 0.1220</span></span>
<span><span class="co">#&gt; SEXM     0.077489  1.080570 0.074388 1.042 0.2976</span></span>
<span><span class="co">#&gt; RATRIALY 0.231692  1.260732 0.091818 2.523 0.0116</span></span>
<span><span class="co">#&gt; RSBP     0.000994  1.000995 0.001310 0.759 0.4479</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=11.8  on 4 df, p=0.01893</span></span>
<span><span class="co">#&gt; n= 18451, number of events= 764</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-the-marginal-distributions">Get the marginal distributions<a class="anchor" aria-label="anchor" href="#get-the-marginal-distributions"></a>
</h2>
<p>Use the <code><a href="../reference/get_marginal_distributions.html">get_marginal_distributions()</a></code> function to get the
marginal distributions, additionally selecting which variables using the
<code>variables</code> parameter.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the Marginal Distributions for the selected variables</span></span>
<span><span class="va">marginals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_marginal_distributions.html">get_marginal_distributions</a></span><span class="op">(</span></span>
<span>  <span class="va">IST</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"AGE"</span>,</span>
<span>    <span class="st">"SEX"</span>,</span>
<span>    <span class="st">"RATRIAL"</span>,</span>
<span>    <span class="st">"RSBP"</span>,</span>
<span>    <span class="st">"STRK14"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="export-the-marginal-distributions">Export the marginal distributions<a class="anchor" aria-label="anchor" href="#export-the-marginal-distributions"></a>
</h2>
<p>Export the marginal distributions using the
<code><a href="../reference/export_marginal_distributions.html">export_marginal_distributions()</a></code> function, using the
<code>force</code> parameter to override any existing files.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export the Marginal Distributions</span></span>
<span><span class="fu"><a href="../reference/export_marginal_distributions.html">export_marginal_distributions</a></span><span class="op">(</span><span class="va">marginals</span>,</span>
<span>                              folder_path <span class="op">=</span> <span class="va">folder_path</span>,</span>
<span>                              force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting  categorical to:  /tmp/RtmpDC59au/categorical_variables.csv</span></span>
<span><span class="co">#&gt; Exporting  binary to:  /tmp/RtmpDC59au/binary_variables.csv</span></span>
<span><span class="co">#&gt; Exporting  continuous to:  /tmp/RtmpDC59au/continuous_variables.csv</span></span>
<span><span class="co">#&gt; Exporting  quantiles to:  /tmp/RtmpDC59au/continuous_quantiles.csv</span></span>
<span><span class="co">#&gt; Exporting  summary to:  /tmp/RtmpDC59au/summary.csv</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reimport-marginal-distributions">Reimport marginal distributions<a class="anchor" aria-label="anchor" href="#reimport-marginal-distributions"></a>
</h2>
<p>Import the exported marginal distributions using the
<code><a href="../reference/import_marginal_distributions.html">import_marginal_distributions()</a></code> function</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import the Marginal Distributions</span></span>
<span><span class="va">imported_marginals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_marginal_distributions.html">import_marginal_distributions</a></span><span class="op">(</span>folder_path <span class="op">=</span> <span class="va">folder_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="synthesise-data-from-marginal-distributions-without-correlations">Synthesise data from marginal distributions (without
correlations)<a class="anchor" aria-label="anchor" href="#synthesise-data-from-marginal-distributions-without-correlations"></a>
</h2>
<p>Synthesise data from the imported marginals using the
<code>synthesise_data</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Synthesise a dataset from the imported Marginal Distributions (without correlations)</span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synthesise_data.html">synthesise_data</a></span><span class="op">(</span><span class="va">imported_marginals</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summarise-the-synthesised-data">Summarise the synthesised data<a class="anchor" aria-label="anchor" href="#summarise-the-synthesised-data"></a>
</h2>
<p>Summarise the simulated data</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert any Character variables to Factors</span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="va">sim_df</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="va">factor</span><span class="op">)</span></span>
<span><span class="co"># Summarise the synthesised data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;        id        SEX       RATRIAL       STRK14             AGE       </span></span>
<span><span class="co">#&gt;  Min.   :    1   F: 9086    :  982   Min.   :0.00000   Min.   :17.00  </span></span>
<span><span class="co">#&gt;  1st Qu.: 4860   M:10349   N:15266   1st Qu.:0.00000   1st Qu.:65.00  </span></span>
<span><span class="co">#&gt;  Median : 9718             Y: 3187   Median :0.00000   Median :73.00  </span></span>
<span><span class="co">#&gt;  Mean   : 9718                       Mean   :0.04229   Mean   :71.57  </span></span>
<span><span class="co">#&gt;  3rd Qu.:14576                       3rd Qu.:0.00000   3rd Qu.:80.00  </span></span>
<span><span class="co">#&gt;  Max.   :19435                       Max.   :1.00000   Max.   :98.00  </span></span>
<span><span class="co">#&gt;       RSBP      </span></span>
<span><span class="co">#&gt;  Min.   : 79.0  </span></span>
<span><span class="co">#&gt;  1st Qu.:141.0  </span></span>
<span><span class="co">#&gt;  Median :160.0  </span></span>
<span><span class="co">#&gt;  Mean   :159.8  </span></span>
<span><span class="co">#&gt;  3rd Qu.:176.0  </span></span>
<span><span class="co">#&gt;  Max.   :290.0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-cox-model-on-the-simulated-data">Fit a cox model on the simulated data<a class="anchor" aria-label="anchor" href="#fit-a-cox-model-on-the-simulated-data"></a>
</h2>
<p>Fit the same cox model as earlier except this time on the simulated
data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># As before the events are measured at day 14</span></span>
<span><span class="va">sim_df</span><span class="op">$</span><span class="va">DAY</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span></span>
<span><span class="co"># Show that the missing observations are in the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sim_df</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 982</span></span>
<span></span>
<span><span class="co"># Remove the missing observations</span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="va">sim_df</span><span class="op">[</span><span class="op">!</span><span class="va">sim_df</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">==</span> <span class="st">""</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove the missing factor name</span></span>
<span><span class="va">sim_df</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">sim_df</span><span class="op">$</span><span class="va">RATRIAL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show that there are no missing observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_df</span><span class="op">$</span><span class="va">RATRIAL</span><span class="op">)</span></span>
<span><span class="co">#&gt;     N     Y </span></span>
<span><span class="co">#&gt; 15266  3187</span></span>
<span></span>
<span><span class="co"># Fit the model on the synthesised data</span></span>
<span><span class="va">cox.ph.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">DAY</span>, <span class="va">STRK14</span><span class="op">)</span> <span class="op">~</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RATRIAL</span> <span class="op">+</span> <span class="va">RSBP</span>, data <span class="op">=</span> <span class="va">sim_df</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Show a summary of the model</span></span>
<span><span class="va">cox.ph.sim</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(DAY, STRK14) ~ AGE + SEX + RATRIAL + RSBP, </span></span>
<span><span class="co">#&gt;     data = sim_df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               coef exp(coef)  se(coef)      z      p</span></span>
<span><span class="co">#&gt; AGE       0.006539  1.006561  0.003154  2.073 0.0381</span></span>
<span><span class="co">#&gt; SEXM     -0.128197  0.879680  0.072031 -1.780 0.0751</span></span>
<span><span class="co">#&gt; RATRIALY -0.001382  0.998619  0.095327 -0.014 0.9884</span></span>
<span><span class="co">#&gt; RSBP     -0.002892  0.997113  0.001323 -2.186 0.0288</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=12.41  on 4 df, p=0.01452</span></span>
<span><span class="co">#&gt; n= 18453, number of events= 771</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="synthesise-data-with-correlations">Synthesise data with correlations<a class="anchor" aria-label="anchor" href="#synthesise-data-with-correlations"></a>
</h2>
<p>Synthesise data from the imported marginals with correlations, by
exporting an empty correlation matrix, then reimporting it and using the
<code>correlation_matrix</code> parameter to specify the correlation
matrix. Note the matrix was edited in R for this example but users would
be expected to edit the correlation matrix in a program such as
excel.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export an empty correlation matrix</span></span>
<span><span class="fu"><a href="../reference/export_empty_cor_matrix.html">export_empty_cor_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">imported_marginals</span>,</span>
<span>  folder_path <span class="op">=</span> <span class="va">folder_path</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Reimport the matrix</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_cor_matrix.html">import_cor_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">folder_path</span>, <span class="st">"correlation_matrix.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Add assumed correlations (note the symmetry)</span></span>
<span><span class="va">cor_matrix</span><span class="op">[</span><span class="st">"RATRIAL_N"</span>, <span class="st">"STRK14"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.02</span></span>
<span><span class="va">cor_matrix</span><span class="op">[</span><span class="st">"STRK14"</span>, <span class="st">"RATRIAL_N"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.02</span></span>
<span></span>
<span><span class="co"># Synthesise data specifying the correlation matrix</span></span>
<span><span class="va">sim_df_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synthesise_data.html">synthesise_data</a></span><span class="op">(</span><span class="va">imported_marginals</span>, correlation_matrix <span class="op">=</span> <span class="va">cor_matrix</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summarise-the-synthesised-data-1">Summarise the synthesised data<a class="anchor" aria-label="anchor" href="#summarise-the-synthesised-data-1"></a>
</h2>
<p>Summarise the synthesised data (with correlations)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to Factors from Character variables</span></span>
<span><span class="va">sim_df_cor</span> <span class="op">&lt;-</span> <span class="va">sim_df_cor</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="va">factor</span><span class="op">)</span></span>
<span><span class="co"># Summarise the synthesised dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_df_cor</span><span class="op">)</span></span>
<span><span class="co">#&gt;        id        SEX       RATRIAL       STRK14             AGE      </span></span>
<span><span class="co">#&gt;  Min.   :    1   F: 4130    :  151   Min.   :0.00000   Min.   :16.0  </span></span>
<span><span class="co">#&gt;  1st Qu.: 4860   M:15305   N:18620   1st Qu.:0.00000   1st Qu.:65.0  </span></span>
<span><span class="co">#&gt;  Median : 9718             Y:  664   Median :0.00000   Median :73.0  </span></span>
<span><span class="co">#&gt;  Mean   : 9718                       Mean   :0.03828   Mean   :71.6  </span></span>
<span><span class="co">#&gt;  3rd Qu.:14576                       3rd Qu.:0.00000   3rd Qu.:80.0  </span></span>
<span><span class="co">#&gt;  Max.   :19435                       Max.   :1.00000   Max.   :99.0  </span></span>
<span><span class="co">#&gt;       RSBP    </span></span>
<span><span class="co">#&gt;  Min.   : 77  </span></span>
<span><span class="co">#&gt;  1st Qu.:141  </span></span>
<span><span class="co">#&gt;  Median :160  </span></span>
<span><span class="co">#&gt;  Mean   :160  </span></span>
<span><span class="co">#&gt;  3rd Qu.:176  </span></span>
<span><span class="co">#&gt;  Max.   :291</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-cox-model-on-the-simulated-data-with-correlations">Fit a cox model on the simulated data with correlations<a class="anchor" aria-label="anchor" href="#fit-a-cox-model-on-the-simulated-data-with-correlations"></a>
</h2>
<p>Using the synthesised data (with correlations) fit a Cox PH model,
with the same parameters as earlier.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Again events are measured at 14 days</span></span>
<span><span class="va">sim_df_cor</span><span class="op">$</span><span class="va">DAY</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span></span>
<span><span class="co"># Again check that the missing values where added</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sim_df_cor</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 151</span></span>
<span></span>
<span><span class="co"># Again remove the missing values</span></span>
<span><span class="va">sim_df_cor</span> <span class="op">&lt;-</span> <span class="va">sim_df_cor</span><span class="op">[</span><span class="op">!</span><span class="va">sim_df_cor</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">==</span> <span class="st">""</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Again drop the missing factor</span></span>
<span><span class="va">sim_df_cor</span><span class="op">$</span><span class="va">RATRIAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">sim_df_cor</span><span class="op">$</span><span class="va">RATRIAL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show there are no missing values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_df_cor</span><span class="op">$</span><span class="va">RATRIAL</span><span class="op">)</span></span>
<span><span class="co">#&gt;     N     Y </span></span>
<span><span class="co">#&gt; 18620   664</span></span>
<span></span>
<span><span class="co"># Fit the model on the synthesised data (with correlations)</span></span>
<span><span class="va">cox.ph.sim.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">DAY</span>, <span class="va">STRK14</span><span class="op">)</span> <span class="op">~</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RATRIAL</span> <span class="op">+</span> <span class="va">RSBP</span>, data <span class="op">=</span> <span class="va">sim_df_cor</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show a summary of the model</span></span>
<span><span class="va">cox.ph.sim.cor</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(DAY, STRK14) ~ AGE + SEX + RATRIAL + RSBP, </span></span>
<span><span class="co">#&gt;     data = sim_df_cor)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              coef exp(coef) se(coef)     z     p</span></span>
<span><span class="co">#&gt; AGE      0.003287  1.003292 0.003197 1.028 0.304</span></span>
<span><span class="co">#&gt; SEXM     0.026197  1.026543 0.090866 0.288 0.773</span></span>
<span><span class="co">#&gt; RATRIALY 0.182798  1.200571 0.186449 0.980 0.327</span></span>
<span><span class="co">#&gt; RSBP     0.000207  1.000207 0.001336 0.155 0.877</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=2.06  on 4 df, p=0.7241</span></span>
<span><span class="co">#&gt; n= 19284, number of events= 735</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ryan Field, David McAllister.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
